<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP 27 Library - Police Family Members</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .form-section {
            transition: all 0.3s ease;
        }
        .photo-preview {
            width: 120px;
            height: 150px;
            object-fit: cover;
            border: 2px dashed #ccc;
        }
        .table-container {
            max-height: 500px;
            overflow-y: auto;
        }
        .highlight-row {
            background-color: #f0f9ff;
        }
    </style>
</head>
<body class="bg-gray-50">
    <header class="bg-blue-800 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">DSP 27 Library</h1>
                    <p class="text-blue-200">Government Library for Police Officers & Their Families</p>
                </div>
                <div class="bg-white p-2 rounded-full">
                    <img src="https://via.placeholder.com/60" alt="Library Logo" class="h-12 w-12 rounded-full">
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-md overflow-hidden mb-8">
            <div class="bg-blue-700 text-white px-6 py-4">
                <h2 class="text-xl font-semibold">Member Registration Form</h2>
            </div>
            
            <form id="memberForm" class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- User Type Selection -->
                    <div class="col-span-2">
                        <label class="block text-gray-700 font-medium mb-2">Member Type</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="memberType" value="student" class="form-radio text-blue-600" checked>
                                <span class="ml-2">Student</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="memberType" value="police" class="form-radio text-blue-600">
                                <span class="ml-2">Police Officer</span>
                            </label>
                        </div>
                    </div>

                    <!-- Basic Information -->
                    <div>
                        <label for="fullName" class="block text-gray-700 font-medium mb-2">Full Name</label>
                        <input type="text" id="fullName" name="fullName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="dob" class="block text-gray-700 font-medium mb-2">Date of Birth</label>
                        <input type="date" id="dob" name="dob" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div>
                        <label for="age" class="block text-gray-700 font-medium mb-2">Age</label>
                        <input type="number" id="age" name="age" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" readonly>
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-gray-700 font-medium mb-2">Phone Number</label>
                        <input type="tel" id="phone" name="phone" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div class="col-span-2">
                        <label for="address" class="block text-gray-700 font-medium mb-2">Address</label>
                        <textarea id="address" name="address" rows="3" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                    </div>

                    <!-- Reference Member Information -->
                    <div id="referenceSection">
                        <label for="referenceName" class="block text-gray-700 font-medium mb-2">Reference Member Name</label>
                        <input type="text" id="referenceName" name="referenceName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div id="referencePostSection">
                        <label for="referencePost" class="block text-gray-700 font-medium mb-2">Reference Member Post</label>
                        <input type="text" id="referencePost" name="referencePost" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>

                    <!-- Photo Uploads -->
                    <div class="col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Passport Size Photo</label>
                            <div class="flex items-center space-x-4">
                                <div>
                                    <img id="passportPreview" src="https://via.placeholder.com/120x150" alt="Passport Preview" class="photo-preview">
                                </div>
                                <div>
                                    <input type="file" id="passportPhoto" name="passportPhoto" accept="image/*" class="hidden" required>
                                    <button type="button" onclick="document.getElementById('passportPhoto').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                        <i class="fas fa-upload mr-2"></i>Upload Photo
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Police ID Card Photo</label>
                            <div class="flex items-center space-x-4">
                                <div>
                                    <img id="idCardPreview" src="https://via.placeholder.com/120x150" alt="ID Card Preview" class="photo-preview">
                                </div>
                                <div>
                                    <input type="file" id="idCardPhoto" name="idCardPhoto" accept="image/*" class="hidden" required>
                                    <button type="button" onclick="document.getElementById('idCardPhoto').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                                        <i class="fas fa-upload mr-2"></i>Upload ID Card
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 flex justify-end space-x-4">
                    <button type="reset" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                        <i class="fas fa-redo mr-2"></i>Reset Form
                    </button>
                    <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-user-plus mr-2"></i>Register Member
                    </button>
                </div>
            </form>
        </div>

        <!-- Member Records Section -->
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
            <div class="bg-blue-700 text-white px-6 py-4">
                <h2 class="text-xl font-semibold">Library Members</h2>
            </div>
            
            <div class="p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div class="relative w-full md:w-64">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="searchInput" placeholder="Search by member number or name..." class="pl-10 w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div class="flex items-center">
                        <span class="text-gray-700 mr-2">Total Members:</span>
                        <span id="totalMembers" class="font-bold text-blue-700">0</span>
                    </div>
                </div>
                
                <div class="table-container border rounded-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Member #</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reference</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="memberTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Member data will be inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Member Detail Modal -->
    <div id="memberModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center bg-blue-700 text-white px-6 py-4">
                <h3 class="text-xl font-semibold">Member Details</h3>
                <button onclick="closeModal()" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="col-span-1">
                        <img id="modalPassport" src="" alt="Passport Photo" class="w-full h-auto rounded-lg border">
                        <div class="mt-4">
                            <img id="modalIdCard" src="" alt="ID Card" class="w-full h-auto rounded-lg border">
                        </div>
                    </div>
                    
                    <div class="col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <p class="text-gray-500 text-sm">Member Number</p>
                                <p id="modalNumber" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Member Type</p>
                                <p id="modalType" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Full Name</p>
                                <p id="modalName" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Date of Birth</p>
                                <p id="modalDob" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Age</p>
                                <p id="modalAge" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Phone Number</p>
                                <p id="modalPhone" class="font-medium"></p>
                            </div>
                            <div class="md:col-span-2">
                                <p class="text-gray-500 text-sm">Address</p>
                                <p id="modalAddress" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Reference Member</p>
                                <p id="modalReference" class="font-medium"></p>
                            </div>
                            <div>
                                <p class="text-gray-500 text-sm">Reference Post</p>
                                <p id="modalReferencePost" class="font-medium"></p>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-end space-x-3">
                            <button onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2023 DSP 27 Library. All rights reserved.</p>
            <p class="text-gray-400 mt-2">Government Library exclusively for Police Officers and their family members.</p>
        </div>
    </footer>

    <script>
        // Initialize member data array
        let members = JSON.parse(localStorage.getItem('libraryMembers')) || [];
        let currentEditId = null;

        // DOM elements
        const memberForm = document.getElementById('memberForm');
        const memberTableBody = document.getElementById('memberTableBody');
        const searchInput = document.getElementById('searchInput');
        const totalMembersSpan = document.getElementById('totalMembers');
        const dobInput = document.getElementById('dob');
        const ageInput = document.getElementById('age');
        const passportPhoto = document.getElementById('passportPhoto');
        const idCardPhoto = document.getElementById('idCardPhoto');
        const passportPreview = document.getElementById('passportPreview');
        const idCardPreview = document.getElementById('idCardPreview');
        const referenceSection = document.getElementById('referenceSection');
        const referencePostSection = document.getElementById('referencePostSection');
        const memberTypeRadios = document.querySelectorAll('input[name="memberType"]');
        const memberModal = document.getElementById('memberModal');

        // Calculate age from date of birth
        dobInput.addEventListener('change', function() {
            if (this.value) {
                const dob = new Date(this.value);
                const today = new Date();
                let age = today.getFullYear() - dob.getFullYear();
                const monthDiff = today.getMonth() - dob.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                    age--;
                }
                
                ageInput.value = age;
            }
        });

        // Handle member type change
        memberTypeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'police') {
                    referenceSection.innerHTML = `
                        <label class="block text-gray-700 font-medium mb-2">Police ID Number</label>
                        <input type="text" id="referenceName" name="referenceName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                    referencePostSection.innerHTML = `
                        <label class="block text-gray-700 font-medium mb-2">Police Rank/Post</label>
                        <input type="text" id="referencePost" name="referencePost" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                } else {
                    referenceSection.innerHTML = `
                        <label for="referenceName" class="block text-gray-700 font-medium mb-2">Reference Member Name</label>
                        <input type="text" id="referenceName" name="referenceName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                    referencePostSection.innerHTML = `
                        <label for="referencePost" class="block text-gray-700 font-medium mb-2">Reference Member Post</label>
                        <input type="text" id="referencePost" name="referencePost" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                }
            });
        });

        // Preview uploaded photos
        passportPhoto.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    passportPreview.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        idCardPhoto.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(event) {
                    idCardPreview.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Form submission
        memberForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const memberType = document.querySelector('input[name="memberType"]:checked').value;
            
            // Read photos as base64
            const passportFile = passportPhoto.files[0];
            const idCardFile = idCardPhoto.files[0];
            
            Promise.all([
                readFileAsDataURL(passportFile),
                readFileAsDataURL(idCardFile)
            ]).then(([passportData, idCardData]) => {
                const newMember = {
                    id: Date.now(),
                    memberNumber: members.length + 1,
                    memberType: memberType,
                    fullName: formData.get('fullName'),
                    dob: formData.get('dob'),
                    age: formData.get('age'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    referenceName: formData.get('referenceName'),
                    referencePost: formData.get('referencePost'),
                    passportPhoto: passportData,
                    idCardPhoto: idCardData,
                    createdAt: new Date().toISOString()
                };
                
                members.push(newMember);
                saveMembers();
                renderMemberTable();
                this.reset();
                passportPreview.src = "https://via.placeholder.com/120x150";
                idCardPreview.src = "https://via.placeholder.com/120x150";
                
                // Show success message
                alert('Member registered successfully!');
            });
        });

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Save members to localStorage
        function saveMembers() {
            localStorage.setItem('libraryMembers', JSON.stringify(members));
            totalMembersSpan.textContent = members.length;
        }

        // Render member table
        function renderMemberTable(filteredMembers = null) {
            const dataToRender = filteredMembers || members;
            memberTableBody.innerHTML = '';
            
            if (dataToRender.length === 0) {
                memberTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-gray-500">No members found</td>
                    </tr>
                `;
                return;
            }
            
            dataToRender.forEach(member => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.dataset.id = member.id;
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${member.memberNumber}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${member.fullName}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${member.memberType === 'student' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                            ${member.memberType === 'student' ? 'Student' : 'Police Officer'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">${member.referenceName}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${member.phone}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="viewMemberDetails(${member.id})" class="text-blue-600 hover:text-blue-800 mr-3">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button onclick="editMember(${member.id})" class="text-yellow-600 hover:text-yellow-800 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                memberTableBody.appendChild(row);
            });
            
            totalMembersSpan.textContent = members.length;
        }

        // View member details
        function viewMemberDetails(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                document.getElementById('modalNumber').textContent = member.memberNumber;
                document.getElementById('modalType').textContent = member.memberType === 'student' ? 'Student' : 'Police Officer';
                document.getElementById('modalName').textContent = member.fullName;
                document.getElementById('modalDob').textContent = member.dob;
                document.getElementById('modalAge').textContent = member.age;
                document.getElementById('modalPhone').textContent = member.phone;
                document.getElementById('modalAddress').textContent = member.address;
                document.getElementById('modalReference').textContent = member.referenceName;
                document.getElementById('modalReferencePost').textContent = member.referencePost;
                document.getElementById('modalPassport').src = member.passportPhoto;
                document.getElementById('modalIdCard').src = member.idCardPhoto;
                
                memberModal.classList.remove('hidden');
            }
        }

        // Close modal
        function closeModal() {
            memberModal.classList.add('hidden');
        }

        // Edit member
        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (member) {
                currentEditId = id;
                
                // Set form values
                document.querySelector(`input[name="memberType"][value="${member.memberType}"]`).checked = true;
                document.getElementById('fullName').value = member.fullName;
                document.getElementById('dob').value = member.dob;
                document.getElementById('age').value = member.age;
                document.getElementById('phone').value = member.phone;
                document.getElementById('address').value = member.address;
                document.getElementById('referenceName').value = member.referenceName;
                document.getElementById('referencePost').value = member.referencePost;
                passportPreview.src = member.passportPhoto;
                idCardPreview.src = member.idCardPhoto;
                
                // Trigger member type change if needed
                if (member.memberType === 'police') {
                    referenceSection.innerHTML = `
                        <label class="block text-gray-700 font-medium mb-2">Police ID Number</label>
                        <input type="text" id="referenceName" name="referenceName" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                    referencePostSection.innerHTML = `
                        <label class="block text-gray-700 font-medium mb-2">Police Rank/Post</label>
                        <input type="text" id="referencePost" name="referencePost" class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    `;
                    document.getElementById('referenceName').value = member.referenceName;
                    document.getElementById('referencePost').value = member.referencePost;
                }
                
                // Scroll to form
                document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Delete member
        function deleteMember(id) {
            if (confirm('Are you sure you want to delete this member?')) {
                members = members.filter(m => m.id !== id);
                
                // Reassign member numbers
                members.forEach((member, index) => {
                    member.memberNumber = index + 1;
                });
                
                saveMembers();
                renderMemberTable();
            }
        }

        // Search functionality
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            
            if (searchTerm === '') {
                renderMemberTable();
                return;
            }
            
            const filteredMembers = members.filter(member => 
                member.memberNumber.toString().includes(searchTerm) ||
                member.fullName.toLowerCase().includes(searchTerm) ||
                member.phone.includes(searchTerm)
            );
            
            renderMemberTable(filteredMembers);
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderMemberTable();
        });
    </script>
</body>
</html>